# Stuck Reasons Configuration
# Single source of truth for stuck_reason -> action, team, runbook, SLA
# Used by: skills/order-details.md, skills/triage-and-assign.md

stuck_reasons:
  # === Ops Team ===
  status_sync_issue:
    team: Ops
    sla_hours: 1
    runbook: runbooks/status-sync-issue.md
    action: "Force-sync via AlphaDesk, verify LULU=CREDITED"
    escalation: "TechOps if webhook replay fails"
    severity: 0.6

  falcon_failed_order_completed_issue:
    team: Ops
    sla_hours: 2
    runbook: runbooks/falcon-failed.md
    action: "Verify payout at partner (get UTR), force GOMS update via AlphaDesk"
    escalation: "TechOps if GOMS update fails"
    severity: 0.9

  brn_issue:
    team: Ops
    sla_hours: 4
    runbook: runbooks/brn-issue.md
    action: "Get BRN from acquirer, push to Lulu via AlphaDesk"
    escalation: "Lulu support (Binoy)"
    severity: 0.65

  stuck_at_lean_recon:
    team: Ops
    sla_hours: 4
    runbook: runbooks/lean-recon.md
    action: "Check Lean Admin recon queue, trigger manual recon if stuck"
    escalation: "Ahsan (Lean Slack)"
    severity: 0.7

  stuck_at_lulu:
    team: Ops
    sla_hours: 8
    runbook: runbooks/stuck-at-lulu.md
    action: "Check Lulu Dashboard, escalate to Binoy if >48h"
    escalation: "binoy.francis@ae.luluexchange.com"
    severity: 0.6

  refund_pending:
    team: Ops
    sla_hours: 2
    runbook: runbooks/refund-pending.md
    action: "URGENT: Check acquirer refund queue, initiate if missing"
    escalation: "FinOps"
    severity: 1.0
    customer_impact: true
    sub_reasons:
      refund_checkout_not_initiated:
        description: "Checkout CAPTURED, no refund initiated"
        action: "Initiate refund in Checkout dashboard"
      refund_checkout_pending:
        description: "Checkout refund initiated, awaiting completion"
        action: "Monitor Checkout refund queue, escalate if >4h"
      refund_lean_not_initiated:
        description: "Lean payment, refund not initiated"
        action: "Initiate refund via Lean Admin"
      refund_lean_pending:
        description: "Lean refund initiated, awaiting recon"
        action: "Check Lean recon queue"
      refund_manual_pending:
        description: "UAE_MANUAL payment, manual refund needed"
        action: "Process manual refund via FinOps"
      refund_lulu_cancellation:
        description: "Lulu CANCELLATION_COMPLETED, excess credit"
        action: "Check checkout capture status, refund excess"
      refund_order_failed:
        description: "Order FAILED, payment captured, no downstream"
        action: "Verify no Lulu/Falcon record, initiate refund"

  cancellation_pending:
    team: Ops
    sla_hours: 4
    runbook: runbooks/cancellation-pending.md
    action: "Check Lulu status, request cancellation or recall"
    escalation: "Lulu support for recalls"
    severity: 0.95

  stuck_at_rda_partner:
    team: Ops
    sla_hours: 8
    runbook: runbooks/stuck-at-rda-partner.md
    action: "Check RDA partner dashboard, escalate if >24h"
    escalation: "RDA partner support"
    severity: 0.55
    sub_reasons:
      rda_processing_no_rfi:
        description: "RDA processing normally, no RFI"
        action: "Monitor, escalate to RDA partner if >24h"
      rda_onhold_no_rfi:
        description: "RDA ONHOLD, needs RFI creation (bug)"
        action: "BUG: Create RFI manually, flag engineering"
      rda_onhold_rfi_pending:
        description: "RDA ONHOLD, RFI sent, waiting customer"
        action: "Monitor RFI response, nudge customer if >24h"
      rda_payout_failed:
        description: "RDA payout FAILED"
        action: "Check RDA partner for failure reason, retry or escalate"

  stuck_due_to_payment_issue_goms:
    team: Ops
    sla_hours: 4
    runbook: runbooks/goms-payment-issue.md
    action: "Check acquirer capture status, manual recon if needed"
    escalation: "TechOps"
    severity: 0.55
    sub_reasons:
      gbp_await_retry_intent:
        description: "sub_state AWAIT_RETRY_INTENT (payment gateway retry loop)"
        action: "Check TrueLayer/acquirer, manual capture if stuck"
      gbp_pending_no_fulfillment:
        description: "sub_state PENDING, no fulfillment created"
        action: "Check GOMS fulfillment trigger, escalate to TechOps"

  uncategorized:
    team: Ops
    sla_hours: 8
    runbook: runbooks/uncategorized.md
    action: "INVESTIGATE: Full system review - GOMS/Falcon/Lulu/Payout"
    escalation: "TechOps if pattern unclear"
    severity: 0.4

  # === KYC Ops Team ===
  rfi_order_within_24_hr:
    team: KYC_ops
    sla_hours: 24
    runbook: runbooks/rfi-pending.md
    action: "MONITOR ONLY - do NOT nudge customer"
    escalation: null
    severity: 0.3
    no_action: true

  rfi_order_grtr_than_24_hr:
    team: KYC_ops
    sla_hours: 24
    runbook: runbooks/rfi-pending.md
    action: "Nudge customer via email/SMS"
    escalation: "Customer support for outreach"
    severity: 0.7

  stuck_at_rda_partner_rfi_within_24_hrs:
    team: KYC_ops
    sla_hours: 24
    runbook: runbooks/rda-rfi.md
    action: "MONITOR - RDA waiting on RFI"
    escalation: null
    severity: 0.3
    no_action: true

  stuck_at_rda_partner_rfi_grtr_than_24_hrs:
    team: KYC_ops
    sla_hours: 24
    runbook: runbooks/rda-rfi.md
    action: "URGENT: Nudge customer, RDA partner blocked"
    escalation: "Customer support"
    severity: 0.7
    customer_impact: true

  no_rfi_created:
    team: KYC_ops
    sla_hours: 4
    runbook: runbooks/no-rfi-created.md
    action: "BUG: Create RFI manually in AlphaDesk, flag engineering"
    escalation: "TechOps (RFI automation)"
    severity: 0.85

  stuck_due_trm:
    team: KYC_ops
    sla_hours: 8
    runbook: runbooks/stuck-due-trm.md
    action: "Check ComplianceReview in AlphaDesk, release or create RFI"
    escalation: "Compliance team"
    severity: 0.6
    sub_reasons:
      gbp_trm_compliance_hold:
        description: "TRM hold, no RFI, compliance review needed"
        action: "Check ComplianceReview in AlphaDesk, release if clean"
      gbp_trm_rfi_awaiting_customer:
        description: "TRM + RFI, waiting on customer docs"
        action: "Monitor RFI response, nudge if >24h"

  stuck_due_trm_rfi_within_24_hrs:
    team: KYC_ops
    sla_hours: 24
    runbook: runbooks/stuck-due-trm.md
    action: "MONITOR - TRM waiting on customer docs"
    escalation: null
    severity: 0.3
    no_action: true

  stuck_due_trm_rfi_grtr_than_24_hrs:
    team: KYC_ops
    sla_hours: 24
    runbook: runbooks/stuck-due-trm.md
    action: "Nudge customer for TRM docs"
    escalation: "Customer support"
    severity: 0.65

  # === VDA Ops Team ===
  stuck_at_vda_partner:
    team: VDA_ops
    sla_hours: 8
    runbook: runbooks/stuck-at-vda-partner.md
    action: "Check VDA partner dashboard, force sync if completed"
    escalation: "VDA partner support"
    severity: 0.5

  bulk_vda_order_within_16_hrs:
    team: VDA_ops
    sla_hours: 16
    runbook: runbooks/bulk-vda.md
    action: "MONITOR - bulk VDA normal window"
    escalation: null
    severity: 0.3
    no_action: true

  bulk_vda_order_grtr_than_16_hrs:
    team: VDA_ops
    sla_hours: 16
    runbook: runbooks/bulk-vda.md
    action: "Escalate to VDA partner support"
    escalation: "VDA partner support"
    severity: 0.5

# Scoring config (inline - no separate file needed for agents)
scoring:
  weights: { age: 0.25, amount: 0.20, severity: 0.25, rfi: 0.15, payment: 0.10 }
  age_thresholds: { 72: 1.0, 36: 0.9, 24: 0.7, 12: 0.5, 0: 0.1 }
  amount_thresholds: { 15000: 1.0, 5000: 0.8, 2000: 0.7, 500: 0.5, 0: 0.1 }
  priority_map: { 0.7: "P1", 0.5: "P2", 0.3: "P3", 0: "P4" }

# Teams reference
teams:
  Ops: { slack: "#ops-ecm", escalation: "ops-lead@agentura.com" }
  KYC_ops: { slack: "#kyc-ops", escalation: "kyc-lead@agentura.com" }
  VDA_ops: { slack: "#vda-ops", escalation: "vda-lead@agentura.com" }
