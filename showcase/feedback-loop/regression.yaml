# AUTO-GENERATED by Agentura Feedback Loop
# Promptfoo regression tests from user corrections
# These tests ensure past mistakes are never repeated

description: "Regression tests from user corrections"

providers:
  - id: openrouter:anthropic/claude-sonnet-4-5-20250929
    config:
      temperature: 0

prompts:
  - file://../../showcase/domains/wealth/suggest-allocation/SKILL.md

tests:
  # CORR-001: Per-market risk differentiation
  - description: "User with moderate profile wants aggressive India equity"
    vars:
      risk_profile: "moderate"
      investment_horizon: "medium"
      monthly_surplus: "AED 13,000"
      goals: |
        1. Mumbai apartment: INR 1.5Cr by 2028 (45% funded, URGENT)
        2. Children education: USD 200K by 2040 (6% funded)
        3. Retirement: INR 5Cr by 2050 (9% funded)
      user_note: "I want aggressive allocation for India equity because my apartment deadline is tight. Keep international holdings conservative."
    assert:
      - type: llm-rubric
        value: "Output must show DIFFERENT equity allocations for India vs international. India equity should be 70%+ allocation."
      - type: contains-any
        value:
          - "aggressive"
          - "higher allocation"
          - "70%"
          - "80%"
      - type: not-contains
        value: "uniform moderate allocation across all markets"

  # CORR-002: Beneficiary cross-check before Quick Approve
  - description: "Alert with beneficiary receiving from multiple users must NOT be Quick Approved"
    vars:
      alert: |
        event_id: EVT-TEST-001
        amount: AED 1,200
        trm_rule_tag: SOURCE_ACCOUNT_NAME_MISMATCH
        severity: Warning
        composite_risk_score: 15
        order_count_30d: 5
        previous_alerts_count: 0
      additional_context: |
        Beneficiary BEN-7832 has received from 4 different users in the past 7 days.
        Total volume to this beneficiary from all users: AED 18,200.
    assert:
      - type: not-contains
        value: "Quick Approve"
      - type: llm-rubric
        value: "Output must classify this alert as 'Needs Investigation' due to the beneficiary receiving from multiple users. The low amount is irrelevant â€” cross-user beneficiary patterns take priority."
      - type: contains-any
        value:
          - "Investigation"
          - "money mule"
          - "cross-user"
          - "multiple users"

  # General: Currency risk note for NRI investors
  - description: "NRI allocation must always include currency risk note"
    vars:
      risk_profile: "moderate"
      country_of_residence: "UAE"
      nationality: "Indian"
      portfolio_currencies: "AED (40%), INR (50%), USD (10%)"
    assert:
      - type: llm-rubric
        value: "Output must include a specific currency risk warning about INR/AED exposure. Must mention that INR depreciation affects goal progress."
      - type: contains-any
        value:
          - "currency risk"
          - "FX"
          - "exchange rate"
          - "depreciation"
